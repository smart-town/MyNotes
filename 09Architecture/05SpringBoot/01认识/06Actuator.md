# Actuator

SpringBootActuator 的关键特性是在应用程序里提供众多　web 端点，通过它们了解程序运行时的内部状况。有了　Actuator ，你可以知道　Bean 在应用程序上下文中是如何组装在一起的，掌握应用程序可以获取的环境属性信息，获取运行时度量信息的快照。Actuator 提供了约 13 个端点，如`/autoconfig`、`/beans`等

要启用 Actuator，只需要加入依赖：`compile 'org.springframework.boot:spring-boot-starter-actuator'`

## 查看配置明细

### 获得 Bean 装配报告

`/beans`可以了解应用程序中 Spring 的上下文情况，他会返回一个 JSON 文档，描述上下文里每个 Bean 的情况，包括其 Java 类型以及注入的其他 Bean。实际上写一个工具，将 Bean 报告处理一下并不是很难。

### 详解自动配置

`/autoconfig`端点能够告诉你为什么会有这个 Bean，或者为什么没有这个 Bean。

`/autoconfig`端点提供了一个报告，列出了计算过的所有条件，根据条件是否通过进行分组。

### 查看配置属性

`/env`端点会生成应用程序可用的所有环境属性的列表，无论这些属性是否用到。这其中包括环境变量、JVM 属性、命令行参数以及 application.properties 或 application.yml 提供的属性。基本上，任何能够给 SpringBoot 应用程序提供属性的属性源都会列在`/env`的结果里，同时会显示具体的属性。

`/env`端点还可以获取单个属性的值，只需要在请求时在`/env`后面加上属性名即可。如`/env/test_id`。

### 端点到控制器的映射

`/mappings`端点提供了一个列表，罗列出应用程序发布的全部端点。

## 运行时度量

### 查看应用程序

关于运行中的程序，有很多有趣且有用的信息。如，了解应用程序的内存情况有助于决定给 JVM 分配多少内存。对于 web 应用程序而言，不用查看 web 服务器日志，如果请求失败或者耗时太长，就可以大概知道内存的情况了。

运行中的程序有诸多计数器和度量器，`/metrics`端点提供了这些东西的快照。

### 追踪 web 请求

尽管`/metrics`提供了一些针对 web 请求的基本的计数器和计时器，但是那些度量值缺少详细的信息。知道所处理请求的更多信息是很有帮助的，尤其是在调试时。所以就有了`/trace`这个端点。

`/trace`端点能够报告所有 web 请求的详细信息，包括请求方法、路径、时间戳、请求和响应头信息。

### 导出线程活动

`/dump`端点会生成当前线程活动的快照。

### 监控程序健康情况

如果想知道程序是否在运行，可以直接访问`/health`端点。一般情况下，可能是简单的 UP 状态。

但是 health 端点可以提供更多信息，如磁盘的空间以及应用程序正在使用的数据库的状态也可以看到。

## 关闭应用程序

`/shutdown`端点。假设要关闭运行中的应用程序，如在微服务架构中，有多个微服务应用的实例运行在云上，其中某个实例有问题了，你需要关闭该实例并让云服务提供商为你重启这个应用，这时候`/shutdown`端点就很有用了。

默认情况下该端点关闭，可以通过`endpoints.shutdown.enable=true`来开启。

## 获取应用信息

`/info`端点可以展示你希望发布的各种应用信息。默认响应可能是`{}`。

可以通过`info.contactEmail="uaaa"`类似的方式设置。

## Actuator 远程 shell

Actuator 通过 REST 端点提供了不少非常有用的信息。另一个深入运行中应用程序内部的方式是使用远程 shell。SpringBoot集成了 CRaSH，一种能够嵌入任意 Java 应用程序的 shell。SpringBoot 扩展了该 shell，添加了不少特有命令。

需要添加对应的依赖：`spring-boot-starter-remote-shell`

