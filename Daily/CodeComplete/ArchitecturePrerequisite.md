# 架构的先决条件

Architecture Pre-requisite

软件架构是软件设计的高层部分，是用于支撑更细节的设计的框架。架构也称为“系统架构”、“高层设计”、“顶层设计”。通常会用一份独立的文档描述架构，这份文档称为“架构规格书”

为什么要将架构作为前期准备呢？因为架构的质量决定了系统的“概念完整性”，后者继而决定了系统的最终质量。一个经过慎重考虑的架构为“从顶层到底层维护系统的概念完整性”提供了必备的结构和体系，它为程序员提供乐指引——其细节程度与程序员的技能和手边的工作相匹配，它将工作分为几个部分，使得多个开发者或者多个开发团队可以独立工作。

好的架构使得构建活动变得更容易。糟糕的架构则使得构建活动几乎寸步难行。

## 架构的典型组成部分

很多组成部分是优秀的架构所共有的，如果你自己构建整个系统，那么在架构工作会与更详细的设计工作有重叠部分，在这种情况下，你至少应该思考架构的每个组成部分，如果你目前从事的系统架构是别人做的，那么你应该能够不费力地找到其中重要的组成部分。在这两种情况下，你都应该考虑以下的架构组成部分

### 2.1 程序组织 Program Organization

系统架构首先要以概括的形式对有关系统做一个综述。

在架构中，你应该能够发现对那些曾经考虑过的最终组织结构的替代方案的记叙，找到之所以选用最终的组织结构而不用其他替代方案的理由。如果对某个类在系统中的角色没有一个清晰的构思，那么编写这个类就是一件令人灰心丧气的工作。描述其他组织结构，才能说明架构最后选定的这种系统组织结构的缘由，并且表明各个类都是慎重考虑过的。

架构应该定义程序的主要构造块。根据程序规模的不同，各个构造块可能是单个类，也可能是由许多类组成的一个子系统。每个构造块无论是一个类还是一组协同工作的类和子程序，它们共同实现一种高层功能，诸如与用户交互、显示 web 页面、解释命令、封装业务规则、访问数据，等等。

应该明确定义各个构造块的责任，每个构造块应该负责某一个区域的事情，并且对其他构造块负责的区域知道得越少越好。通过使得各个构造块对于其他块的了解达到最小，你能够将设计的信息局限于各个构造块之内。

应该明确定义每个构造块的通信规则，对于每个构造块，架构应该描述它能够直接使用哪些构造块，能间接使用哪些构造块，不能使用哪些构造块。

### 2.2 主要的类 Main Class

架构应该详细定义所使用的主要的类，它应该指出每个主要的类的责任，以及该类如何与其他类进行交互。它应该包含对类的继承体系、状态转换、对象持久化等的描述。如果系统足够大，它应该描述如何将这些类组织成一个个子系统。

架构应该记述曾经考虑过的其他类设计方案，并给出选用当前的组织结构的理由。架构无须详细说明系统中的每个类，瞄准 80/20 法则：对那些构成系统 80% 行为的 20% 的类进行详细说明。

### 2.3 数据设计 Data Design

架构应该描述所用到的主要文件和数据表的设计，应该描述曾经考虑过的其他方案，并说明做出选择的理由。

数据通常只应该由一个子系统或者一个类直接访问；例外的情况就是透过访问器类或访问器子程序。

架构应该详细定义所用数据库的高层组织结构和内容，架构应该解释为什么单个数据库比多个数据库要好，解释为什么不用平坦的文件而用数据库，指出与其他访问同一数据的程序的可能的交互方式，说明会创建哪些数据视图等。

### 2.4 业务规则 Business Rule

如果架构依赖于特定的业务规则，那么它就应该详细描述这些规则，并描述这些规则对于系统设计的影响。例如，假定要求系统遵循这样一条规则：客户信息过时的时间不能超过 20 秒，在这种情况下，架构就应该描述这条规则对架构采用的“保持客户信息及时更新且同步”的方法的影响。

### 2.5 用户界面设计 User Interface Design

用户界面常常在需求阶段进行详细说明，如果没有就应该在软件架构中进行详细说明。架构应该详细定义 web 页面格式、GUI 命令行接口等主要元素。精心设计的用户界面架构决定了最终做出来的是“人见人爱的程序”还是“没人爱用的程序”

架构应该模块化，以便在替换为新用户界面时不影响业务规则和程序的输出部分。例如架构应该使我们很容易做到：砍掉交互式界面的类，插入一组命令行的类，这种替换能力常常很有用，尤其因为命令行界面便于单元级别和子系统级别的软件测试。

### 2.6 资源管理 Resource Management

架构应该描述一份管理稀缺资源的计划，稀缺资源包括数据库连接、线程、句柄等。在内存受限的应用领域，如嵌入式系统中，内存管理是架构中应该认真对待的另一个重要领域。

### 2.7 安全性

架构应该描述实现设计层面和代码层面的安全性的方法，如果先前尚未建立威胁模型，那么就应该在架构阶段建立威胁模型。在制定编码规范的时候应该将安全性牢记在心，包括处理缓冲区的方法、处理非受信数据（用户输入数据、cookies、等）的规则、加密、错误消息的细致程度、保护内存中的秘密数据，以及其他事项。

### 2.8 性能 Performance

如果需要关注性能，就应该在需求中详细定义性能目标，可以包括资源的使用。

### 2.9. 可伸缩性

可伸缩性指的是系统增长以满足未来需求的能力。架构应该描述系统如何应对用户数量、服务器数量、网络节点数量、数据库记录数等的增长。如果预计系统不会增长，而且可伸缩性不是问题，那么架构应该明确列出这一假设。

### 2.10 互用性

如果预计这个系统会与其他软件或者硬件共享资源或数据，那么应该描述如何完整这一任务

### 2.11 国际化（本地化）

### 2.12 输入输出

输入输出是架构中值得注意的另一领域，架构应该详细定义读取策略是先做、后做还是即时做，而且应该描述在哪一层检测 I/O 错误：在字段、记录、流或文件的层次。