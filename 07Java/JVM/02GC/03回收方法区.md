# 回收方法区

很多人认为方法区是没有垃圾收集的，JVM 规范中确实说过不要求虚拟机在方法区中实现垃圾收集，而且在方法区中进行垃圾收集的“性价比”一般比较低，在堆中尤其是新生代中，常规应用一次垃圾收集一般可以回收 70%~95% 的空间，而方法区的垃圾收集的效率远低于此。

方法区的垃圾收集主要回收两部分内容：废弃常量和无用的类。回收废弃常量和回收 Java 堆中对象非常类似。以常量池中字面量的回收为例子，假设一个字符串"abc"已经进入了常量池，但是当前系统中没有任何一个`String`对象叫做"abc"，即没有任何`String`对象引用`abc`常量，也没有其他地方引用了这个字面量，如果这个时候发生内存回收，而且必要的话，这个`abc`常量就会被系统清理出常量池。常量池中的其他类、方法、字段的符号引用也与此类似。

判断一个常量是否废弃比较简单，但是判断一个类是否是无用的类，则条件苛刻很多。类需要同时满足以下 3 个条件才算是“无用的类”：
- 该类所有实例已被回收
- 加载该类的 ClassLoader 已被回收
- 该类对应的`java.lang.Class`没有在任何地方被引用。

虚拟机可以对满足上述 3 个条件的无用类进行回收。这里说的仅仅是“可以“。是否对类进行回收，HotSpot JVM 提供了`-Xnoclassgc`参数进行控制。