# 服务概览

`Service`是一种可以在后台执行长时间运行操作而不提供界面的应用程序。服务可以由其他组件启动，而且即使用户切换到其他应用，服务仍将在后台继续运行。此外，组件可以绑定到服务与之交互，甚至是执行进程间通信。

三种不同的服务类型：
- 前台：前台服务执行一些用户能注意到的操作。例如，音频应用会使用前台服务来播放音频曲目。前台服务必须显示**通知**。即使用户停止与应用的交互，前台服务仍会运行。
- 后台：后台服务执行用户不会注意到的操作。例如，如果应用使用某个服务来压缩其存储空间，则此服务通常是后台服务。 注意，如果应用是面向 API 26 或者更高的级别，当应用本身并未在前台运行时，系统会对运行后台服务施加限制。在诸如此类的大多数情况下，你的应用应该改为使用**计划作业**。
- 绑定：当应用组件通过调用`bindService()`绑定到服务时，服务处于**绑定状态**。绑定服务会提供客户端-服务端接口，以便组件与服务交互、发送请求、接收结果等。仅当与另一个应用组件绑定时，绑定服务才会运行。多个组件可以同时绑定到该服务，但是全部取消绑定后，该服务会被销毁。

## 服务和线程

简单地说，服务是一种即使用户未与应用交互也可以在后台运行的组件。因此，只有在需要服务的时候才创建服务。

如果你必须在主线程之外执行操作，但是只在用户和你的应用交互时执行此操作。则应该创建线程。

请记住，如果你确实需要使用服务，默认情况下，它仍然会在应用的主线程中运行，因此，如果服务执行的是密集型或阻止型操作，你应该在服务内创建新线程。

## 基础知识

创建服务必须创建`Service`子类（或使用其现有子类）。实现中必须处理一些回调方法， 从而处理服务生命周期中的某些关键方面，并提供一种机制将组件绑定到服务，以下是应重写的最重要的几个方法：

- `onStartCommand()`: 当一个组件（如Activity)请求启动服务时，系统会通过`startService`来调用此方法。执行此方法时，服务会启动并可在后台无限期运行。如果你实现此方法，则在服务完成后，需要负责调用`stopSelf()`或`stopService()`来停止服务。
- `onBind()`：当一个组件想要与服务绑定时，系统会通过调用`bindService()`来调用此方法，在此方法中，你必须通过返回一个`IBinder`提供一个接口，以供客户端用来与服务端通信。但是如果你并不希望绑定，则应返回`null`
- `onCreate()`： 首次创建服务时，系统会调用此方法执行一次性设置程序。如果服务已经在运行则不会调用此方法
- `onDestroy()`：当不再使用服务并准备将其销毁时，系统会调用此方法，服务应该通过此方法来清理任何资源。如线程、注册的侦听器等。

如果组件通过调用`startService()`启动服务，则服务会一直运行。直到其使用`stopSelf()`自行停止或由其他组件通过调用`stopService()`将其停止。

如果组件通过调用`bindService()`来创建服务，且未调用`startService`，则服务只会在该组件与其绑定时运行，当该服务与其所有组件取消绑定后，系统便会将其销毁。

只有在内存过低且必须回收系统资源以供拥有用户焦点的`Activity`使用时，Android 才会停止服务。如果将服务绑定到拥有用户焦点的`Activity`上，则它不太可能停止。如果将服务声明为在前台运行，则其几乎永远不会停止。如果服务已经启动并长时间运行，则系统逐渐降低其在后台任务列表中的位置，而服务被终止的概率也会大幅度提升——如果服务是启动服务，你必须设计为能够妥善处理系统执行的重启。如果系统终止服务，则其会在资源可用时立即重启服务，但是这还是取决于你从`onStartCommand`返回的值。