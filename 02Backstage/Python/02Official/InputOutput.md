# InputOutput 输入输出

## 1. 更漂亮的输出格式

有三种写入值的方法：表达式语句、`print()`函数、文件对象的`write()`方法（输出文件作为`sys.stdout`引用）

通常，你需要更多地控制输出的格式，而不仅仅是打印空格分隔的值。有几种格式化的方法：
- 要使用**格式化字符串字面值**，请在字符串的开始引号或三引号之前加上一个`f`或`F`，在此字符串中可以在`{`和`}`之间写可以引用的变量或字面值的 Python 表达式。
    `f'Result is {event}'`
- 字符串的`str.format()`方法提供更多手动操作，你仍将使用`{`和`}`来标记变量将被替换的位置，并且可以提供详细的格式化指令，但是你还需要提供格式化信息：  
    ```python
    yes_votes = 42_572
    no_votes = 43_132
    percentage = yes_notes / (no_votes + yes_notes)
    '{:-9} YES votes {:2.2%}'.format(yes_votes, percentage)
    ```
- 最后，你可以使用字符串切片和连接操作自己完成所有字符串处理。

当你不需要花哨的输出而只是想快速显示某些变量以进行调试时，可以使用`repr()`和`str()`函数将任何值转换为字符串

`str()`用于返回人类可读的值的表示。而`repr()`用于生成解释器可读的表示（如果没有等效的语法，则强制执行`SyntaxError`），对于没有人类可读性的表示的对象，两者返回值相同。很多值使用任一函数都有相同的表示。

### 1.1 格式化字符串文字

**格式化字符串文字**，常称为(f-字符串)，可选的格式说明符号可以跟在表达式后面，这样可以更好地控制值的格式化方式，如以下实例小数后三位：`print(f'The value of pi is {math.pi:.3f}')`

在`:`后传递一个整数可以让该字段成为最小字符宽度，这在列对齐时很有用：
```py
table = {"Sig": 3123, "Jack": "4098"}
for name, phone in table.items():
    print(f'{name:10} ==> {phone:10d}')
```

### 1.2 字符串的 format 方法

`str.format()`基本用法：`print("We are the {} who say {}!".format('knights', 'Ni'))`

花括号和其中的字符（称为格式字段）将替换为传递给`str.format()`方法的对象。花括号中的数字可以用来表示传递给`str.format()`方法的对象的位置。`print("{1} and {0}".format("spam", "eggs"))`

如果在`str.format()`中使用关键字参数，则使用参数的名称引用它们的值：`print('The {food} is {a}'.format(food='spam', a="bread'))`

位置可以和关键字任意组合

### 1.3 手动格式化字符串

### 1.4 旧的字符串格式化方法

`%`操作符也可以用作字符串格式化：`print('the value of pi is %5.3f' % math.pi)`

## 2. 读写文件

`open()`返回一个`file object`。最常用参数：`open(filename, mode)`。

在处理文件对象的时候最好使用`with`关键字，优点是当子句体结束后文件会正确关闭，即使在某个时刻引发了异常。且比`try-finally`代码块简短很多：
```py
with open('workfile') as f:
    read_data = f.read()
f.closed # True
```
如果没有显式使用`with`关键字，那么应该调用`f.close()`来关闭文件以释放它所使用的所有系统资源。如果没有显式关闭文件，Python 的垃圾回收器最终会销毁该对象并为你关闭打开的文件，但是这个文件可能会保持打开状态一段时间，另外一个风险是不同的 Python 实现会在不同的时间进行清理。

### 2.1 文件对象方法

读取文件内容：`f.read(size)`。*size*是一个可选的数值参数，其为负数或被省略时将读取并返回整个文件的内容，如果文件内容的大小是你机器内存的两倍就会出现问题。如果已经到达文件末尾，则返回一个空字符串。

`f.readline()`从文件中读取到一行。要从文件中读取行，可以遍历循环文件中所有行，这是内存高效快速的：
```py
for line in f:
    print(line, end='')
```
也可以使用列表形式读取：`list(f)`或`f.readlines()`。

`f.write(string)`写入文件内容，写入其他类型对象时需要先转换为字符串。

`f.tell()`

`f.seek()`

### 2.2 使用 json 保存结构化数据

字符串可以很容易写入文件并从文件中读取出来，数字可能会费劲，因为`read()`只会返回字符串。这些字符串必须传递给类似`int()`的函数，当你想保存类似嵌套列表和字典这样更复杂的数据类型时，手动解析和序列化会变得很复杂。

Python 允许使用 JSON 这种流行数据交换格式。有名为`json`的标准模块。

如果你有一个对象`x`，可以这样查看它的 JSON 字符串表示：`json.dumps([1, 'temp'])`

此外，`json.dump(x,f)`可以将对象序列化为 text file。（这里`f`就是一个`text file`对象）

要再次解码对象，如果`f`是一个打开的以供阅读的`text file`对象：`x = json.load(f)`。

这种简单的序列化技术可以处理列表和字典，但是在 JSON 中序列化任意类的实例需要额外的努力。

