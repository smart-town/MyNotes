# 微服务不止编写代码

尽管构建单个微服务的概念很易于理解，但是运行和支持健壮的微服务应用程序不只是涉及为服务编写代码。编写健壮的服务需要考虑几个问题：
- 大小适当——如何确保正确划分微服务大小，以避免微服务承担太多的职责。适当的大小允许快速更改应用程序，并降低整个应用程序中断的总体风险
- 位置透明——在微服务应用程序中，多个服务实例可以快速启动和关闭时，如何管理服务调用的物理细节？
- 有弹性——如何通过绕过失败的服务，确保采取“快速失败”的方法来保护微服务消费者和应用程序的整体完整性
- 可重复——如何确保提供的每个新服务实例与生产环境中所有其他服务实例具有相同的配置和代码库
- 可伸缩——如何使用异步处理和事件来最小化服务之间的直接依赖关系，并确保可以优雅扩展为服务。

这里通过基于模式的方法，列出可以跨不同技术实现来使用的通用设计：
- 核心微服务开发模式
- 微服务路由模式
- 微服务客户端弹性模式
- 微服务安全模式
- 微服务日志记录和跟踪模式
- 微服务构建和部署模式

## 核心微服务开发模式

核心微服务开发模式解决了构建微服务的基础问题。
- **服务粒度**
- **通信协议**
- **接口设计**
- **服务配置管理**
- **服务之间的事件处理**

*划分服务本身、服务之间如何通信、通信时的规则、服务本身迁移的配置、*

*服务如何定义、服务如何发布与订阅、服务如何监控、服务如何治理、故障如何定位*

## 微服务路由模式

微服务路由模式负责处理希望消费微服务的客户端应用程序，使客户端应用程序发现服务的位置并路由到服务。在基于云的应用程序中，可能会运行成千上百个微服务实例，需要抽象这些服务的物理 IP 地址，并为服务调用提供单个入口点，以便为所有服务调用持续强制执行安全和内容策略。

服务发现和路由回答这两个问题：如何发将客户的服务请求发送到服务的特定实例

- **服务发现**
- **服务路由**

## 微服务客户端弹性模式

因为微服务架构是高度分布式的，所以必须对如何防止单个服务（或服务实例）中的问题级联暴露给服务的消费者十分敏感
- **客户端负载均衡**: 在服务客户端上缓存服务实例的位置，以便对微服务的多个实例的调用负载均衡到该微服务的所有健康实例上
- **断路由模式**：阻止客户继续调用出现故障的或遭遇性能问题的服务。如果服务执行缓慢，客户端调用时会消耗它的资源。希望出现故障的微服务能够快速失败，以便主叫客户端可以快速响应并采取适当的措施。
- **后备模式**: 当服务调用失败时，如何提供“插件”机制，允许服务的客户端尝试通过调用微服务之外的其他方法来执行工作
- **舱壁模式**: 微服务应用程序使用多个分布式资源来执行工作，如何区分这些调用，以便表现不佳的服务调用不会对应用程序的其他部分产生负面影响。

## 微服务安全模式

- 验证——确定调用服务的客户端是它所声称的服务端？
- 授权——确定调用服务的客户端有权限
- 凭据管理和传播——避免客户端每次都要提供凭据信息才能访问事务中涉及的服务调用

## 微服务日志记录和跟踪模式

## 微服务构建和部署模式