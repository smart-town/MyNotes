# 认识

Zookeeper 是一个开源的分布式协调服务。由雅虎创建，是 Google Chubby 的开源实现。分布式应用程序可以基于Zookeeper实现诸如数据发布/订阅、负载均衡、命名服务、分布式协调/通知、集群管理、配置维护等等。

一些系统在线运行时，需要在不停止程序的情况下能够动态调整某一个变量并能够及时生效。特别是当部署了多台应用服务器的时候，需要能够做到在一台机器上修改配置文件，然后再同步到所有应用服务器上。这时候使用 Zookeeper 就很合适了。

**Zookeeper 是一个高可用的分布式数据管理和系统协调框架。基于对 Paxos 算法的实现，使得该框架保证了分布式环境中数据的强一致性，也正是基于这样的特性**，使得 Zookeeper 解决了很多分布式问题。所以值得注意的是，Zk 并非就是为了以下的应用场景设计的，都是后来众多开发者根据其框架的特性，利用其提供的一系列API接口，摸索出来的典型用法。

*即是说，zk 是一个用于协调各个机器之间通信的框架？*

## 分布式系统

分布式系统是由独立的计算机通过网络连接在一起，并且通过一些组件来相互交流和协作来完成一个共同的目标。*为什么会出现？特点（基本组成）？*

难点：可以想象加入一台计算机出错的概率为0.1%，那么1000台服务器出错的概率呢？一旦计算机的数量增多，出错的概率就会大大增加。*出现什么问题呢？对于单个计算机来说？对于连接的场景来说？*

**分布式应用**可以在给定时间在网络中的多个系统上运行，通过协调它们以快速有效的方式完成特定任务。通常来说，对于复杂而耗时的任务，非分布式应用（运行在单个系统中）需要几个小时才能完成，而分布式应用通过使用所有系统涉及的计算能力可以在几分钟内完成。

通过将分布式应用配置为在更多系统上运行，可以进一步减少完成任务所用的时间。分布式应用正在运行的一组系统统称为**集群**，而在集群中运行的每台机器被称为**节点**。分布式应用有两部分：**Server**和**Client**应用程序，服务器的应用程序实际上是分布式的，并有通用接口，以便客户端可以连接到集群中的任何服务器并获得相同的结果。客户端应用程序是与分布式应用进行交互的工具。

*这里似乎有问题*分布式实际上是解决中心化管理的问题，把所有的任务叠加到一个节点上处理，太慢了。所以把一个大的问题拆分为多个小的问题，并分别解决，最终协同合作。分布式的主要工作是分解任务，将职能分解。**集群**的主要使用场景是为了分担请求的压力，也就是在几个服务器上部署相同的应用程序，来分担客户端的请求。当压力进一步增大的时候，可能在需要存储的部分，mysql无法面对很多的写能力，因为mysql做成集群之后，主要的写压力还是在master的机器上面，其他机器无法分担压力，从而这个时候也要引出分布式。集群主要是简单加机器解决问题，对于问题本身不做任何分解；分布处理必然包含任务分解和答案归并。分布式中的某个子任务节点，可能由一个集群来代替；集群中的任何一个节点都是做一个完整的任务。集群和分布式都是由多个节点组成的，但是集群之间的通信协调基本不需要，而分布式各个节点的通信协调必不可少。

**将一套系统拆分成不同的子系统部署在不同服务器上，这叫分布式。然后部署多个相同的子系统在不同的服务器上，这叫集群。部署在不同服务器上的同一个子系统应该叫做负载均衡**

分布式应用的优点：
- 可靠性：单个或几个系统的故障不会使整个系统出现故障
- 可扩展性： 可以在需要时增加性能，通过添加更多的机器，在应用程序配置中进行微小的更改而不会有停机的时间
- 透明性： 隐藏系统的复杂性，并将其显示为单个实体/应用程序

分布式应用的挑战
- 竞争条件：两个或者多个机器尝试执行特定任务，实际上只需要在任意给定的时间由单个机器完成。
- 死锁
- 不一致

## 什么是 Apache Zookeeper

Apache Zookeeper 是由集群（节点组）使用的一种服务，用于在自身之间进行协调，并通过稳健的同步技术维护共享数据。Zookeeper 本身是一个分布式应用程序，为写入分布式应用程序提供服务。分布式应用程序提供了很多好处，但是它们也抛出了一些复杂和难以解决的挑战，ZooKeeper 框架提供了一个完整的机制来克服所有挑战，。竞争条件和死锁使用**故障安全同步方法**进行处理，另一个主要的缺点是数据的不一致性，Zookeeper 使用**原子性**解析。

### Zookeeper 的好处

- 简单的分布式协调过程
- 同步
- 有序的消息
- 序列化
- 可靠性
- 原子性


## 到底是什么

Zk 实际上是 yahoo 开发的，用于分布式中**一致性处理的框架**。其最初作为研发 Hadoop 的副产品，由于分布式系统中一致性处理较为困难，其他的分布式系统没有必要费劲重复造轮子，因此随后的分布式系统中大量应用了 Zookeeper，以至于 Zookeeper 成为了各种分布式系统的基础组件，其地位之重要可想而知。hadoop、dubbo、kafka 都是基于 Zookeeper 构建的。

要理解 zookeeper 到底是干啥的，首先需要理解，什么是一致性。所谓的一致性，实际上就是围绕着“看见”来的，谁能看见，能够看见，什么时候看见。例如，淘宝后台卖家，在后台架一件大促的商品，通过服务器A提交到主数据库，假设刚刚提交后立马就有用户通过应用服务器 B 去查询数据库，就会出现一个现象：卖家已经更新成功了，然而买家却看不到；而经过一段时间后，主数据库的数据同步到了从数据库，买家就能查到了。

假设卖家更新后买家立马能看到卖家的更新，则称为**强一致性**，如果不能看到则称为**弱一致性**，而经过一段时间最终能看到更新，则称为**最终一致性**。

如果要给一致性下一个定义，可以说是**分布式系统中状态或数据保持同步一致**



## 典型应用场景——数据发布与订阅

发布与订阅模型，即所谓的**配置中心**，顾名思义就是发布者将数据发布到 Zk 节点上，供订阅者动态获取数据，实现配置信息的集中式管理和动态更新。例如全局的配置信息，服务式服务框架的服务地址列表等就非常适合使用。

- 应用中用到的一些配置信息在 Zk 上集中管理。这类的场景通常是这样：应用在启动的时候主动来来获取一次配置，同时，在节点上注册一个 Watcher，这样一来，以后每次配置有更新的时候，都会实时通知到订阅的客户端，来达到获取最新配置信息的目的。
- 分布式搜索服务中，索引的元信息和服务器集群机器的节点状态存放在 Zk 的一些指定节点，供各个客户端订阅使用。
- 分布式日志收集系统，这个系统的核心工作是收集分布在不同机器的日志。收集器通常是按照应用来分配收集任务单元，因此需要在 Zk 上创建一个以应用名作为 path 的节点 P.并将这个应用的所有机器 IP，以子节点的形式注册到节点 P 上，这样一来就能实现机器变动的时候，能够实时通知到收集器调整任务分配。
- 系统中有些信息需要动态获取，并且还会存在人工手动去修改这个信息的发问。通常是暴露出接口，来获取一些运行时的信息。引入 Zk 后，就不用自己实现一套方案了，只要将这些信息存放到指定的 Zk 节点上即可。

【注意】以上的应用场景，有一个默认的前提：数据量很小，但是数据更新可能比较快的场景。

## 其他应用场景

