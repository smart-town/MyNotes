# Git 储藏与清理

有时候当在项目上已经工作一段时间后，所有的东西都进入了混乱状态，这时候如果想要切换到另外一个分支工作。问题在于，你不想仅仅过会儿回到这一点而为做了一半的工作创建一次提交。针对这个问题的答案是`git stash`命令。

储藏会处理工作目录脏的状态，即，修改的跟踪文件与暂存改动，然后将未完成的修改保存到一个栈上，而你可以在任何时候重新应用这些改动。

## 储藏工作

假设当前暂存了`a.js`，修改了`b.js`，那么在目录执行`git stash`后，使用`git status`可以看到目录变干净了。此时就可以轻易切换分支并在其他分支工作。

要查看储藏的东西：`git stash list`。

要重新应用储藏的东西：`git stash apply [stash@{n}]`。不指定名字时则自动应用最新储存的工作。

注意可以在一个分支上保存一个储藏，切换到另外一个分支，然后尝试重新应用这些修改。当应用储藏时工作目录中可以有修改与未提交的文件，如果有任何东西不能干净地应用，Git 会产生合并冲突。

文件的改动被重新应用了，但是之前暂存的文件却没有重新暂存，想要那样的话，必须使用`--index`选项，即`git stash apply --index`，来尝试重新应用暂存的修改。

应用选项只会尝试应用暂存的工作，在堆栈上还有它。可以运行`git stash drop`加上要移除的储藏名字来移除它。

## 创造性储藏

有几个储藏的变种可能也很有用，第一个是`stash save`命令的`--keep-index`选项。它告诉 Git 不要储藏任何你通过`git add`命令已经暂存的东西。当你做了几个改动并只想提交其中一部分时，过会儿再处理剩余改动时会十分有用。

另一个经常使用储藏来做的事情是像储藏文件一样储藏未跟踪文件。默认情况下，`git stash`只会存储已经在索引中的文件。如果指定`--include-untracked`或`-u`标记，Git 也会储藏任何创建的未跟踪文件。`git stash -u`

如果指定了`--patch`标记，Git 不会储藏所有修改过的任何东西。但是会交互式提示 哪些改动想要储藏，哪些改动需要保存到目录中

### 从储藏创建一个分支

如果储藏了一些工作，将它留在那儿了一会儿，然后继续在储藏的分支上工作，重新应用工作时可能有问题。如果应用尝试修改刚刚修改过的文件，你会得到一个合并冲突并不得不解决它。如果想要一个轻松的方式来再次测试储藏的改动，可以运行`git stash branch`来创建一个新的分支，检出储藏工作时所在的提交，重新在那里应用工作，然后在应用成功后扔掉储藏。

这是在新分支轻松恢复储藏工作并继续工作的一个很不错的途径。

## 清理工作目录

对于工作目录中的一些工作或文件，你想做的也许不是储藏而是移除，`git clean`会帮助你做这些事情。

有一些通用的原因比如说为了移除由合并或外部工具生成的东西，或是为了运行一个干净的构建而移除之前构建的残留。

需要谨慎使用这个命令，因为它被设计为从工作目录中移除未被追踪的文件。如果你改变主意了，你也不一定能够找回来那些文件的内容。一个更安全的选项是运行`git clean --all`来移除每一样东西并存放在栈中。

你可以使用`git clean`命令去除冗余文件或清理工作目录。使用`git clean -f -d`移除工作目录中所有未追踪的文件以及空的工作目录。

如果只是想看看它会做什么，可以使用`-n`选项来运行命令。这意味着“做一次演习”然后告诉你将要移除什么。`git clean -d -n`

如果不知道`git clean`命令将要做什么，在真正做之前总是用`-n`来检查一下。
