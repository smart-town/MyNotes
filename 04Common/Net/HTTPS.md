# HTTPS

## 过程

1. 客户端发起请求，发送客户端支持的加密协议以及版本
2. 服务器从中筛选合适的加密协议，并返回证书，证书中有服务器的公钥
3. 客户端使用根证书验证证书的合法性
4. 客户端生成对称秘钥(一个随机值?)，通过证书中的公钥加密，发送到服务端
5. 服务端使用私钥解密，获取对称秘钥，使用对称秘钥加密数据
6. 客户端解密数据，SSL 开始通信...

## TLS/SSL

`Transport Layer Security`/`Security Sockets Layer`

`TLS`就是由`SSL`发展而来的。主要提供三个基本服务：
- 加密
- 身份验证
- 消息完整性校验

## 证书机制

`TLS`中，我们需要用证书来保证你所访问的服务器是真实的。（因为Alice可以称自己为Bob）。

1. 客户端拿到了站点证书、站点公钥
2. 要验证站点可信后，才能使用其公钥，因此客户端找到其站点证书颁发者的信息
3. 站点证书的颁发者验证了服务端站点是可信的，但是客户端依然不清楚该颁发者是否可信
4. 再向上回溯，找到认证了中间证书商的源头证书颁发者，由于源头的证书颁发者非常少，我们浏览器之前就认识了，因此可以认为根证书颁发者是可信的
5. 那么，证书颁发者可信，那么它所颁发的证书也可信，最终确定了我们所访问的服务端是可信的。
6. 客户端使用证书中的公钥，继续 TLS 握手过程。

**客户端是如何验证某个证书的有效性，或者说验证策略是什么呢？**

一般是 **CRL** 和 **OCSP**。分别是浏览器缓存以及在线证书状态协议(Online Certificate Status Protocol)

