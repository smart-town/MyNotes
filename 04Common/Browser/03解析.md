# 解析

解析是呈现引擎中非常重要的一个环节，因此我们要更深入地讲解。

**解析文档指的是将文档转化为有意义的结构，也就是可让代码理解和使用的结构。解析得到的结果通常是代表了文档结构的节点树，它称作解析树或者语法树**

## 语法

解析是以文档所遵循的语法规则（编写文档所用的语言或者格式）为基础的。所有可以解析的格式都必须对应确定的语法（由词汇和语法构成）。这称为**与上下文无关语法**。人类语言并不属于这样的语言，因此无法用常规的解析技术进行解析。

## 解析器和词法分析器的组合

解析的过程可以分为两个子过程：词法分析和语法分析。

词法分析将输入内容分割为大量标记。标记是语言中的词汇，即构成内容的单位。在人类语言中，它相当于语言字典中的单词。

语法分析是应用语言的语法规则的过程。

解析器通常将解析分为以下两个组件来处理：**词法分析器**（也称为**标记生成器**），负责将输入的内容分解成一个个有效的标记；而**解析器**负责根据语言的语法规则分析文档的结构，从而构建解析树。词法分析器知道如何将无关的字符（如空格和换行符）分离出来。

解析是一个迭代的过程，通常解析器会向词法分析器请求一个新标记，并尝试将其与某条语法规则相匹配。如果发现了匹配规则，解析器会将一个对应于该标记的节点添加到解析树中，然后继续请求下一个标记。如果没有规则可以匹配解析器就会将标记存储到内部，并继续请求下一个标记，直到找到可与所有内部存储的标记匹配的规则。如果找不到任何匹配的规则，就会引发一个异常。这意味着文档无效，包含语法错误。


## 翻译

很多时候解析树还不是最终的产物。解析通常是在翻译的过程中使用的，而翻译指的是将输入文档转换为另一种格式。编译就是这样的一个例子。编译器将源代码翻译为机器代码，具体过程是首先将源代码解析为解析树，然后将解析树翻译成机器代码。

## 词汇和语法的正式定义

词汇通常用正则表达式定义，如：
```
INTEGER :0|[1-9][0-9]*
PLUS : +
MINUS : -
```
语法通常用一种称为 BNF 的格式定义，如：
```
expression := term operation term
operation := PLUS | MINUS
term := INTEGER | expression
```

如果语言的语法是**与上下文无关语法**，就可以由常规解析器进行解析。与上下文无关的语法的直观定义就是可以完全用 BNF 格式表达的语法。

## 解析器类型

有两种基本的解析器类型：**自上而下解析器**和**自下而上解析器**。直观来说，自上而下的解析器从语法的高层结构出发，尝试从中找出匹配的结构。而自下而上的解析器从底层规则出发，将输入内容逐步转换为语法规则，直到满足高层规则。

## 自动生成解析器

有一些工具可以帮助你生成解析器，它们称为解析器生成器。你只要向其提供你所用语言的语法（词汇和语法规则），它就会生成相应的解析器。创建解析器需要对解析有深刻理解，而人工创建并优化解析器并不是一件容易的事情，所以解析生成器是非常有用的。

Webkit 使用了两种非常有名的解析器生成器：用于创建词法分析器的 Flex 以及用于创建解析器的 Bison。Flex 的输入是包含标记的正则表达式定义的文件，Bison 的输入是采用 BNF 格式的语言语法规则。