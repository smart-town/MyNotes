# 自定义指令

## 简介

除了核心功能默认内置的指令(`v-model`和`v-show`)。Vue 也允许注册自定义指令，注意，在 Vue2.0 中，代码复用和抽象的主要形式是组件，然后在有的情况下，你仍然需要对普通的 DOM 元素进行操作。这时候就会用到**自定义指令**。

### 简单例子

假设需要对页面上的某个 input 框进行页面加载后自动聚焦的操作，使用指令实现：
```js
// 注册一个全局自定义指令
Vue.directive('focus', {
    // 当元素被插入到 DOM 中时
    inserted: function (el) {
        el.focus()
    }
})
```
注册局部指令，组件中也接受一个`directives`选项。

## 钩子函数

一个指令定义对象可以提供如下几个钩子函数（均可选）：
- `bind`: 只调用一次。指令第一次绑定到元素时可调用。在这里可以进行一次性的初始化设置。
- `inserted`: 被绑定元素插入父节点时调用（仅保证父节点存在，但不一定已经被插入到文档中）
- `update`: 所在组件的 VNode 更新时调用，**但是可能发生在其子 VNode 更新之前**，指令的值可能发生改变也可能没有，但是你可以通过比较更新前后的值来忽略不必要的模板更新。
- `componentUpdated`: 指令所在的组件的 VNode 及其子 VNode 全部更新后调用。
- `unbind`: 只调用一次，指令和元素解绑时调用。

### 钩子函数参数

指令钩子函数会传入以下参数：
- `el`: 指令所绑定的参数，可以用来直接操作 DOM
- `binding`: 一个对象，包含以下属性：
    - `name`: 指令名，不包括`v-`前缀
    - `value`: 指令的绑定值，如`v-my-directive="1+1"`中，绑定值为 2
    - `oldValue`: 指令绑定的前一个值
    - `expression`: 字符串形式的指令表达式，如`v-my-directive="1+1"`中，表达式为`1+1`
    - `arg`: 传给指令的参数，可选，如`v-my-directive:foo`中参数为`foo`
    - `modifiers`: 一个包含修饰符的对象，如`v-my-directive.foo.bar`中，修饰符对象为`{foo:true, bar:true}`
- `vnode`: Vue 编译生成的虚拟节点
- `oldVnode`: 上一个虚拟节点，仅在 update 和 componentUpdated 钩子中可用。

除了 `el` 之外，其他的参数都应该是只读的，切勿进行修改。如果需要在钩子之间共享数据，建议通过`dataset`进行。

