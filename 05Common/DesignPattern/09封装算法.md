# 封装算法

**模板方法**定义了一个算法的步骤，并允许子类为一个或者多个步骤提供实现。

> **模板方法模式**在一个方法中定义了一个算法的骨架，而将一些步骤延迟到子类中。模板方法使得子类可以在不改变算法结构的情况下，重新定义算法中的某些步骤。

什么是模板呢？具体来说，模板就是一个方法，这个方法将算法定义为一组步骤，其中的任何步骤都可以是抽象的，由子类负责实现。这可以确保算法的结构保持不变，同时由子类提供部分实现。

## 基本结构

```java
// 被声明为抽象，用做基类，其子类必须实现其操作
abstract class AbstractClass {
    final void templateMethod() { //模板方法，它被声明为 final，模板方法定义了一连串的步骤，每个步骤由一个方法代表
        primitiveOperation1() ;
        primitiveOperation2() ;
        concreteOperation() ;
        hook() ;
    }
    abstract void primitiveOperation1() ; //该示例中有两个原语操作，具体子类必须实现它们。
    abstract void primitiveOperation2() ;

    final void concreteOperation(){ //这个具体的方法被定义在抽象类中，将其声明为 final，这样一来子类无法覆盖它。它可以被模板方法直接使用，或者被子类使用
        ...
    }
    void hook() {} //“默认不做事”的方法，称这种方法为 hook，子类可以视情况决定要不要覆盖它。
}
```

### 进一步认识

如果子类中必须提供算法中某个方法或者步骤的实现时，就使用抽象方法。如果算法的这个部分是**可选**的，子类可以选择实现这个钩子，但是并不强制。

钩子可以让子类实现算法中可选的部分，或者在钩子对于子类的实现并不重要的时候，子类可以对于此类钩子置之不理。钩子的另外一种用法是，让子类能够有机会对模板方法中某些即将发生的（或刚刚发生的）步骤作出反应。

## 好莱坞原则

> 别调用（打电话给）我们，我们会调用（打电话）给你

好莱坞原则可以给我们一种防止**依赖腐败**的方法，当高层组件依赖低层组件，而低层组件又依赖高层组件时，而高层组件又依赖边侧组件，边侧组件又依赖低层组件时，依赖腐败就发生了。这种情况下，很难搞懂系统是如何设计的。

在好莱坞原则之下，我们允许低层组件将自己挂钩到系统上，但是高层组件会决定什么时候和怎样使用这些低层组件。换句话说，高层组件对待低层组件的方式是“别调用我们，我们调用你”。

低层组件可以参与计算，但是绝对不可以直接调用高层组件。高层组件可以控制如何以及何时让低层组件参与。

### 好莱坞原则和模板方法

好莱坞原则和模板方法之间的连接还算明显：当我们设计模板方法模式时，我们告诉子类，“不要调用我们，我们调用你”。

### 好莱坞原则和依赖倒置原则

依赖倒置原则教我们尽量避免使用具体类，而多使用抽象。好莱坞原则则是在创建框架或者组件上的一种技巧，好让低层组件能够被挂钩到计算中，而且又不会让高层组件依赖低层组件。两者的目标都是解耦。但是依赖倒置更注重如何在设计中避免依赖。

好莱坞原则教我们一个技巧，创建一个有弹性的设计，允许低层结构能够相互操作，又能够防止其他类太过依赖它们。

